version: '3'

tasks:
  qemu:
    vars:
      CLI_ARGS: '{{default "--target qemu --interactive" .CLI_ARGS}}'
    cmds:
      - python3 scripts/qemu/qemu.py {{.CLI_ARGS}}

  qemu-gdb:
    desc: run qemu with attaching gdb
    cmds:
      - python3 scripts/qemu/qemu.py --target qemu --interactive --gdb

  syzkaller:
    desc: run syzkaller image in qemu
    cmds:
      - python3 scripts/qemu/qemu.py --interactive

  # syzkaller-gdb:
  #   desc: run syzkaller image in qemu with attaching gdb
  #   cmds:
  #     - python3 scripts/qemu/qemu.py --whitelist t --interactive --gdb

  # interact:
  #   desc: run syzkaller image with testcases copied into the vm
  #   cmds:
  #     - python3 scripts/qemu/qemu.py --testprogs {{.TESTCASES}} --interactive | tee out/interact-log

  # interact-gdb:
  #   desc: run syzkaller image with testcases copied into the vm with attaching gdb
  #   cmds:
  #     - python3 scripts/qemu/qemu.py --testprogs {{.TESTCASES}} --interactive --gdb | tee out/interact-log
